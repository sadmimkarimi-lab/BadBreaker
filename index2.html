<!DOCTYPE html>
<html lang="fa">
<head>
  <meta charset="UTF-8" />
  <title>Ø´Ú©Ø³ØªÙ† Ø¹Ø§Ø¯Øªâ€ŒÙ‡Ø§ÛŒ Ø¨Ø¯ - Tavita</title>
  <!-- ÙÙˆÙ†Øª ÙØ§Ø±Ø³ÛŒ -->
  <link href="https://fonts.googleapis.com/css2?family=Vazirmatn:wght@300;400;500;700&display=swap" rel="stylesheet">
  <style>
    *{
      margin:0;
      padding:0;
      box-sizing:border-box;
      font-family:'Vazirmatn',sans-serif;
    }
    body{
      background:#111533;
      color:#fff;
      display:flex;
      flex-direction:column;
      height:100vh;
      overflow:hidden;
    }
    #top-bar{
      width:100%;
      padding:8px 14px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      direction:ltr;
      font-size:14px;
      gap:8px;
    }
    #top-left{
      display:flex;
      gap:12px;
      align-items:center;
    }
    #top-right{
      display:flex;
      gap:6px;
      align-items:center;
    }
    .iconBtn{
      border:none;
      padding:4px 10px;
      border-radius:999px;
      background:#2c2e7a;
      color:#fff;
      font-size:14px;
      box-shadow:0 0 6px rgba(0,0,0,.4);
      cursor:pointer;
      white-space:nowrap;
    }
    .iconBtn:active{transform:scale(.97)}

    /* Ù†ÙˆØ§Ø± Ù¾ÛŒØ´Ø±ÙØª ØªØ±Ú© Ø¹Ø§Ø¯Øªâ€ŒÙ‡Ø§ */
    #progressWrap{
      width:100%;
      padding:0 14px 4px;
    }
    #progressBarOuter{
      width:100%;
      height:6px;
      border-radius:999px;
      background:#22244a;
      overflow:hidden;
      box-shadow:0 0 6px rgba(0,0,0,0.6);
    }
    #progressBarInner{
      width:0%;
      height:100%;
      background:linear-gradient(90deg,#22c55e,#a3e635);
      transition:width .2s ease-out;
    }

    /* Ù†ÙˆØ§Ø± Ù¾ÛŒØ§Ù… (Ø¨Ø§Ù„Ø§ Ø²ÛŒØ± Ù†ÙˆØ§Ø± Ù¾ÛŒØ´Ø±ÙØª) */
    #hint-bar{
      width:100%;
      padding:2px 14px 6px;
      font-size:12px;
      direction:rtl;
      color:#e5e7eb;
      opacity:.9;
    }
    #hint{
      width:100%;
      text-align:right;
    }

    #game-container{
      flex:1;
      display:flex;
      align-items:center;
      justify-content:center;
      padding:6px 10px 10px;
    }
    canvas{
      background:#141947;
      border-radius:14px;
      box-shadow:0 0 18px rgba(0,0,0,.7);
      touch-action:none;
    }

    #bottom-bar{
      width:100%;
      padding:6px 14px 10px;
      font-size:12px;
      direction:rtl;
      opacity:.9;
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:8px;
      flex-wrap:wrap;
    }
    #credits{
      min-width:160px;
    }
    #credits b{
      color:#facc15;
    }
    #credits a{
      color:#38bdf8;
      text-decoration:none;
    }
    #credits a:hover{
      text-decoration:underline;
    }
    #bottom-buttons{
      display:flex;
      gap:6px;
      flex-wrap:wrap;
      justify-content:flex-end;
    }
    .btn{
      border:none;
      padding:6px 12px;
      border-radius:999px;
      background:#1abc9c;
      color:#fff;
      font-size:12px;
      cursor:pointer;
      box-shadow:0 0 8px rgba(0,0,0,.5);
      white-space:nowrap;
    }
    .btn-shop{background:#ff8c00;}
    .btn:active{transform:scale(.97)}

    .overlay{
      position:fixed;
      inset:0;
      background:rgba(0,0,0,.7);
      display:none;
      align-items:center;
      justify-content:center;
      z-index:10;
    }
    .box{
      background:#1b144f;
      padding:16px;
      border-radius:16px;
      width:90%;
      max-width:380px;
      box-shadow:0 0 18px rgba(0,0,0,.8);
      direction:rtl;
      text-align:right;
      font-size:13px;
      line-height:1.7;
      position:relative;
    }
    .box h3{
      margin-bottom:8px;
      font-size:16px;
    }
    .box p{margin:4px 0;}
    .closeBtn{
      margin-top:10px;
      width:100%;
      border:none;
      padding:7px 14px;
      border-radius:999px;
      background:#4444aa;
      color:#fff;
      font-size:13px;
      cursor:pointer;
      box-shadow:0 0 8px rgba(0,0,0,.5);
    }
    .closeBtn:active{transform:scale(.97)}

    .shopItem{
      background:#24145f;
      padding:8px;
      border-radius:10px;
      margin:6px 0;
      display:flex;
      justify-content:space-between;
      align-items:center;
      font-size:13px;
      transition:transform .15s ease,box-shadow .15s ease;
    }
    .shopItem span{display:block}
    .shopItem button{
      padding:4px 10px;
      font-size:11px;
      border:none;
      border-radius:999px;
      background:#ff8c00;
      color:#fff;
      cursor:pointer;
    }
    .shopItem.bought{
      transform:scale(1.03);
      box-shadow:0 0 14px rgba(46,204,113,.8);
    }
    #shopMessage{
      position:absolute;
      top:4px;
      left:12px;
      font-size:11px;
      color:#2ecc71;
      opacity:0;
      pointer-events:none;
    }
    .shopMessageVisible{
      animation:shopFlash 1s ease-out forwards;
    }
    @keyframes shopFlash{
      0%{opacity:0;transform:translateY(-4px);}
      20%{opacity:1;transform:translateY(0);}
      80%{opacity:1;}
      100%{opacity:0;transform:translateY(-6px);}
    }

    #gameOverBox p{margin:4px 0;}

    /* Ø§ÙÚ©Øª +Û² Ø¬ÙˆÙ† */
    .lifeGain{
      position:fixed;
      top:6px;
      left:50%;
      transform:translateX(-50%);
      font-size:14px;
      color:#f97316;
      text-shadow:0 0 6px rgba(0,0,0,.7);
      animation:lifeFloat 1s ease-out forwards;
      z-index:20;
      pointer-events:none;
    }
    @keyframes lifeFloat{
      0%{opacity:0;transform:translate(-50%,0);}
      30%{opacity:1;transform:translate(-50%,-6px);}
      100%{opacity:0;transform:translate(-50%,-22px);}
    }
  </style>
</head>
<body>
  <div id="top-bar">
    <div id="top-left">
      <div>Ø§Ù…ØªÛŒØ§Ø²: <span id="scoreEl">0</span></div>
      <div>Ù…Ø±Ø­Ù„Ù‡: <span id="levelEl">1</span></div>
      <div>â¤ï¸ <span id="livesEl">3</span></div>
    </div>
    <div id="top-right">
      <button id="helpBtn" class="iconBtn">â“ Ø±Ø§Ù‡Ù†Ù…Ø§</button>
      <button id="soundBtn" class="iconBtn">ğŸ”Š</button>
      <button id="pauseBtn" class="iconBtn">â¸</button>
    </div>
  </div>

  <!-- Ù†ÙˆØ§Ø± Ù¾ÛŒØ´Ø±ÙØª -->
  <div id="progressWrap">
    <div id="progressBarOuter">
      <div id="progressBarInner"></div>
    </div>
  </div>

  <!-- Ù¾ÛŒØ§Ù…â€ŒÙ‡Ø§ÛŒ Ø¨Ø§Ø²ÛŒ (Ø¨Ø§Ù„Ø§ÛŒ ØµÙØ­Ù‡) -->
  <div id="hint-bar">
    <div id="hint">Ø¨Ø§ Ø§Ù†Ú¯Ø´Øª Ù¾ÙØ¯ Ø±Ø§ Ø­Ø±Ú©Øª Ø¨Ø¯Ù‡ Ùˆ Ø¹Ø§Ø¯Øªâ€ŒÙ‡Ø§ÛŒ Ø¨Ø¯ Ø±Ø§ Ø¨Ø´Ú©Ù† ğŸ’«</div>
  </div>

  <div id="game-container">
    <canvas id="game"></canvas>
  </div>

  <!-- Ù†ÙˆØ§Ø± Ù¾Ø§ÛŒÛŒÙ†: Ø³Ø§Ø®Øª Ø·Ø§ÙˆÛŒØªØ§ + Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§ -->
  <div id="bottom-bar">
    <div id="credits">
      Ø³Ø§Ø®ØªÙ‡ Ø´Ø¯Ù‡ ØªÙˆØ³Ø· <b>Ø·Ø§ÙˆÛŒØªØ§</b> Â·
      <a href="https://eitaa.com/tavita" target="_blank" rel="noopener">ÙˆØ±ÙˆØ¯ Ø¨Ù‡ Ú©Ø§Ù†Ø§Ù„ Ø·Ø§ÙˆÛŒØªØ§</a>
    </div>
    <div id="bottom-buttons">
      <button id="aboutBtn" class="btn">Ø¯Ø±Ø¨Ø§Ø±Ù‡ Ù…Ø§</button>
      <button id="shopBtn" class="btn btn-shop">Ø´Ø§Ù¾</button>
    </div>
  </div>

  <!-- Ø±Ø§Ù‡Ù†Ù…Ø§ÛŒ Ø¨Ø§Ø²ÛŒ -->
  <div id="helpOverlay" class="overlay">
    <div class="box">
      <h3>Ø±Ø§Ù‡Ù†Ù…Ø§ÛŒ Ø¨Ø§Ø²ÛŒ Ø¹Ø§Ø¯Øªâ€ŒØ´Ú©Ù† Ø·Ø§ÙˆÛŒØªØ§ ğŸ®</h3>
      <p>â—€ Ø¨Ø§ Ø§Ù†Ú¯Ø´Øª ÛŒØ§ Ù…Ø§ÙˆØ³ØŒ Ù¾ÙØ¯ Ù¾Ø§ÛŒÛŒÙ† ØµÙØ­Ù‡ Ø±Ø§ Ø­Ø±Ú©Øª Ø¨Ø¯Ù‡ ØªØ§ ØªÙˆÙ¾ Ø¨Ù‡ Ø¢Ø¬Ø±Ù‡Ø§ Ø¨Ø±Ø®ÙˆØ±Ø¯ Ú©Ù†Ø¯ Ùˆ Ø¹Ø§Ø¯Øªâ€ŒÙ‡Ø§ÛŒ Ø¨Ø¯ (ØªÙ†Ø¨Ù„ÛŒØŒ Ø®Ø´Ù…ØŒ Ù†Ø§Ø§Ù…ÛŒØ¯ÛŒ Ùˆ...) Ø±Ø§ ÛŒÚ©ÛŒâ€ŒÛŒÚ©ÛŒ Ø¨Ø´Ú©Ù†ÛŒ.</p>
      <p>â—€ Ù‡Ø± Ø¢Ø¬Ø± ÛŒÚ© Ø¹Ø§Ø¯Øª Ù…Ù†ÙÛŒ Ø§Ø³ØªØ› ÙˆÙ‚ØªÛŒ Ù…ÛŒâ€ŒØ´Ú©Ù†Ø¯ØŒ ÛŒÚ© Ø¬Ù…Ù„Ù‡â€ŒÛŒ Ù…Ø«Ø¨Øª Ùˆ ØªÙ‚ÙˆÛŒØªâ€ŒÚ©Ù†Ù†Ø¯Ù‡ Ø¨Ø§Ù„Ø§ Ù†Ø´Ø§Ù† Ø¯Ø§Ø¯Ù‡ Ù…ÛŒâ€ŒØ´ÙˆØ¯ ØªØ§ Ø¢Ø±Ø§Ù…â€ŒØ¢Ø±Ø§Ù… Ø°Ù‡Ù†â€ŒØ§Øª Ù‡Ù… Ù‡Ù…Ø±Ø§Ù‡ Ø¨Ø§Ø²ÛŒ ØªØºÛŒÛŒØ± Ú©Ù†Ø¯ ğŸŒ±</p>
      <p>â—€ Ù‡Ø± Ù…Ø±Ø­Ù„Ù‡ Ú©Ù‡ Ú©Ø§Ù…Ù„ Ù…ÛŒâ€ŒÚ©Ù†ÛŒØŒ <b>Û² ØªØ§ Ø¬ÙˆÙ† Ø¬Ø¯ÛŒØ¯</b> Ù…ÛŒâ€ŒÚ¯ÛŒØ±ÛŒ â¤ï¸ Ùˆ Ú©Ù…â€ŒÚ©Ù… Ù†ÙˆØ§Ø± Ù¾ÛŒØ´Ø±ÙØª Ø¨Ø§Ù„Ø§ Ù¾Ø± Ù…ÛŒâ€ŒØ´ÙˆØ¯Ø› ÛŒØ¹Ù†ÛŒ Ø¹Ø§Ø¯Øªâ€ŒÙ‡Ø§ÛŒ Ø¨ÛŒØ´ØªØ±ÛŒ Ø±Ø§ Ø´Ú©Ø³ØªÛŒ.</p>
      <p>â—€ Ø¯Ø§ÛŒØ±Ù‡â€ŒÙ‡Ø§ÛŒ Ø±Ù†Ú¯ÛŒ Ú©Ù‡ Ø§Ø² Ø¢Ø¬Ø±Ù‡Ø§ Ù…ÛŒâ€ŒØ§ÙØªØ¯ Ù¾Ø§ÙˆØ±Ø¢Ù¾ Ù‡Ø³ØªÙ†Ø¯Ø› Ø¢Ù†â€ŒÙ‡Ø§ Ø±Ø§ Ø¨Ú¯ÛŒØ± ØªØ§: Ù¾Ø¯ Ø¨Ø²Ø±Ú¯â€ŒØªØ± Ø´ÙˆØ¯ØŒ ØªÙˆÙ¾ Ù‚ÙˆÛŒâ€ŒØªØ± Ø´ÙˆØ¯ØŒ ØªÙˆÙ¾ Ø¢Ù‡Ø³ØªÙ‡â€ŒØªØ± Ø­Ø±Ú©Øª Ú©Ù†Ø¯ ÛŒØ§ Ø­Ø§Ù„Øª Ú†Ù†Ø¯ØªÙˆÙ¾ÛŒ ÙØ¹Ø§Ù„ Ø´ÙˆØ¯ ğŸ˜</p>
      <p>â—€ Ø¯Ø± Â«Ø´Ø§Ù¾Â» Ù…ÛŒâ€ŒØªÙˆØ§Ù†ÛŒ Ø¨Ø§ Ø§Ù…ØªÛŒØ§Ø²Ù‡Ø§ÛŒÛŒ Ú©Ù‡ Ø¬Ù…Ø¹ Ú©Ø±Ø¯ÛŒØŒ Ø±ÙØªØ§Ø±Ù‡Ø§ÛŒ Ø®ÙˆØ¨ (Ù¾Ø§ÙˆØ±Ø¢Ù¾â€ŒÙ‡Ø§ÛŒ Ø¯Ø§Ø¦Ù…â€ŒØªØ±) Ø¨Ø®Ø±ÛŒ Ùˆ Ø¨Ø§Ø²ÛŒ Ø±Ø§ Ø±Ø§Ø­Øªâ€ŒØªØ± Ú©Ù†ÛŒ.</p>
      <button class="closeBtn" id="closeHelp">ÙÙ‡Ù…ÛŒØ¯Ù…ØŒ Ø¨Ø²Ù† Ø¨Ø±ÛŒÙ… ğŸ’ª</button>
    </div>
  </div>

  <!-- Ø¯Ø±Ø¨Ø§Ø±Ù‡ Ù…Ø§ -->
  <div id="aboutOverlay" class="overlay">
    <div class="box">
      <h3>Ø¯Ø±Ø¨Ø§Ø±Ù‡ Ø·Ø§ÙˆÛŒØªØ§ ğŸŒ¸</h3>
      <p>Ø§ÛŒÙ† Ø¨Ø§Ø²ÛŒ ØªÙˆØ³Ø· Â«Ø·Ø§ÙˆÛŒØªØ§Â» Ø·Ø±Ø§Ø­ÛŒ Ø´Ø¯Ù‡ ØªØ§ Ø¨Ù‡ Ø´Ú©Ù„ Ø³Ø§Ø¯Ù‡ Ùˆ Ø¬Ø°Ø§Ø¨ØŒ ØªÙ…Ø±ÛŒÙ† ØªØ±Ú© Ø¹Ø§Ø¯Øªâ€ŒÙ‡Ø§ÛŒ Ø¨Ø¯ Ùˆ ØªÙ‚ÙˆÛŒØª Ø°Ù‡Ù† Ù…Ø«Ø¨Øª Ø±Ø§ Ù„Ø°Øªâ€ŒØ¨Ø®Ø´â€ŒØªØ± Ú©Ù†Ø¯.</p>
      <p>Ø¨Ø§ Ù‡Ø± Ø¨Ø§Ø± Ø´Ú©Ø³ØªÙ† ÛŒÚ© Ø¢Ø¬Ø±ØŒ ÙÙ‚Ø· Ø¯Ø± Ø¨Ø§Ø²ÛŒ Ù¾ÛŒØ´ Ù†Ù…ÛŒâ€ŒØ±ÙˆÛŒØ› Ø¨Ù„Ú©Ù‡ ÛŒÚ© Ù‚Ø¯Ù… Ú©ÙˆÚ†Ú© Ø¨Ø±Ø§ÛŒ Ø±Ø´Ø¯ Ø´Ø®ØµÛŒ Ùˆ Ø¢Ø±Ø§Ù…Ø´ Ø¯Ø±ÙˆÙ†ÛŒâ€ŒØ§Øª Ø¨Ø±Ù…ÛŒâ€ŒØ¯Ø§Ø±ÛŒ.</p>
      <p style="font-size:12px;opacity:.85;">Ø§Ú¯Ø± Ø§ÛŒÙ† Ø³Ø¨Ú© Ø¨Ø§Ø²ÛŒâ€ŒÙ‡Ø§ Ø±Ø§ Ø¯ÙˆØ³Øª Ø¯Ø§Ø±ÛŒØŒ Ø¯Ø± Ú©Ø§Ù†Ø§Ù„ Ø·Ø§ÙˆÛŒØªØ§ Ù‡Ù…Ø±Ø§Ù‡ Ù…Ø§ Ø¨Ø§Ø´ ØªØ§ Ø§Ø¨Ø²Ø§Ø±Ù‡Ø§ÛŒ Ø¨ÛŒØ´ØªØ±ÛŒ Ø¨Ø±Ø§ÛŒ Ø±Ø´Ø¯ Ùˆ ÛŒØ§Ø¯Ú¯ÛŒØ±ÛŒ Ø¯Ø±ÛŒØ§ÙØª Ú©Ù†ÛŒ ğŸŒ±</p>
      <button class="closeBtn" id="closeAbout">Ø¨Ø³ØªÙ†</button>
    </div>
  </div>

  <!-- Ø´Ø§Ù¾ -->
  <div id="shopOverlay" class="overlay">
    <div class="box" id="shopBox">
      <h3>ÙØ±ÙˆØ´Ú¯Ø§Ù‡ Ø±ÙØªØ§Ø±Ù‡Ø§ÛŒ Ø®ÙˆØ¨ ğŸŒ±</h3>
      <div id="shopMessage"></div>
      <div class="shopItem" data-item-row="pad">
        <span>Ù¾ÙØ¯ Ø¢Ú¯Ø§Ù‡â€ŒØªØ± (Ù¾Ù‡Ù†â€ŒØªØ± Ø´Ø¯Ù† Ù¾ÙØ¯)</span>
        <span>Ù‡Ø²ÛŒÙ†Ù‡: 150 Ø§Ù…ØªÛŒØ§Ø²</span>
        <button data-item="pad">Ø®Ø±ÛŒØ¯</button>
      </div>
      <div class="shopItem" data-item-row="strength">
        <span>ØªÙ„Ø§Ø´ Ø¨ÛŒØ´ØªØ± (ØªÙˆÙ¾ Ù‚ÙˆÛŒâ€ŒØªØ±)</span>
        <span>Ù‡Ø²ÛŒÙ†Ù‡: 220 Ø§Ù…ØªÛŒØ§Ø²</span>
        <button data-item="strength">Ø®Ø±ÛŒØ¯</button>
      </div>
      <div class="shopItem" data-item-row="slow">
        <span>Ø¢Ø±Ø§Ù…Ø´ Ø¯Ø±ÙˆÙ† (Ú©Ù†Ø¯ Ø´Ø¯Ù† ØªÙˆÙ¾ Ø¨Ø±Ø§ÛŒ Ú©Ù†ØªØ±Ù„ Ø¨Ù‡ØªØ±)</span>
        <span>Ù‡Ø²ÛŒÙ†Ù‡: 180 Ø§Ù…ØªÛŒØ§Ø²</span>
        <button data-item="slow">Ø®Ø±ÛŒØ¯</button>
      </div>
      <button class="closeBtn" id="closeShop">Ø¨Ø³ØªÙ†</button>
    </div>
  </div>

  <!-- Ú¯ÛŒÙ… Ø§ÙˆØ± -->
  <div id="gameOverOverlay" class="overlay">
    <div class="box" id="gameOverBox">
      <h3>Ù¾Ø§ÛŒØ§Ù† Ø¨Ø§Ø²ÛŒ ğŸ®</h3>
      <p id="goScore">Ø§Ù…ØªÛŒØ§Ø² Ø´Ù…Ø§: 0</p>
      <p id="goLevel" style="font-size:12px;opacity:.85;"></p>
      <p style="font-size:12px;opacity:.9;">
        Ù…ÛŒâ€ŒØªÙˆÙ†ÛŒ Ø¯ÙˆØ¨Ø§Ø±Ù‡ ØªÙ„Ø§Ø´ Ú©Ù†ÛŒ Ùˆ Ø¹Ø§Ø¯Øªâ€ŒÙ‡Ø§ÛŒ Ø¨Ø¯ Ø¨ÛŒØ´ØªØ±ÛŒ Ø±Ùˆ Ø¨Ø´Ú©Ù†ÛŒ ğŸ˜
      </p>
      <button id="retryBtn" class="closeBtn">Ø¯ÙˆØ¨Ø§Ø±Ù‡ ØªÙ„Ø§Ø´ Ú©Ù†</button>
    </div>
  </div>

  <script>
    const canvas = document.getElementById("game");
    const ctx = canvas.getContext("2d");
    const scoreEl = document.getElementById("scoreEl");
    const levelEl = document.getElementById("levelEl");
    const livesEl = document.getElementById("livesEl");
    const soundBtn = document.getElementById("soundBtn");
    const pauseBtn = document.getElementById("pauseBtn");
    const helpBtn = document.getElementById("helpBtn");
    const aboutBtn = document.getElementById("aboutBtn");
    const hintEl = document.getElementById("hint");
    const helpOverlay = document.getElementById("helpOverlay");
    const closeHelpBtn = document.getElementById("closeHelp");
    const aboutOverlay = document.getElementById("aboutOverlay");
    const closeAboutBtn = document.getElementById("closeAbout");
    const shopOverlay = document.getElementById("shopOverlay");
    const shopBtn = document.getElementById("shopBtn");
    const closeShopBtn = document.getElementById("closeShop");
    const shopMessage = document.getElementById("shopMessage");
    const gameOverOverlay = document.getElementById("gameOverOverlay");
    const goScore = document.getElementById("goScore");
    const goLevel = document.getElementById("goLevel");
    const retryBtn = document.getElementById("retryBtn");
    const progressInner = document.getElementById("progressBarInner");
    let w, h;

    function resizeCanvas(){
      w = Math.min(window.innerWidth*0.95,420);
      h = Math.min(window.innerHeight*0.8,720);
      canvas.width = w;
      canvas.height = h;
    }
    resizeCanvas();
    window.addEventListener("resize", resizeCanvas);

    // ØµØ¯Ø§
    let audioCtx;
    let isMuted = false;
    function beep(freq=600,dur=0.06){
      if(isMuted) return;
      try{
        if(!audioCtx) audioCtx = new (window.AudioContext||window.webkitAudioContext)();
        const osc = audioCtx.createOscillator();
        const gain = audioCtx.createGain();
        osc.frequency.value = freq;
        osc.type="square";
        gain.gain.value = 0.08;
        osc.connect(gain);
        gain.connect(audioCtx.destination);
        osc.start();
        osc.stop(audioCtx.currentTime+dur);
      }catch(e){}
    }
    soundBtn.onclick=()=>{
      isMuted = !isMuted;
      soundBtn.textContent = isMuted ? "ğŸ”‡" : "ğŸ”Š";
    };

    // Ø±Ø§Ù‡Ù†Ù…Ø§
    helpBtn.onclick = ()=>{ helpOverlay.style.display="flex"; };
    closeHelpBtn.onclick = ()=>{ helpOverlay.style.display="none"; };
    helpOverlay.addEventListener("click",e=>{
      if(e.target===helpOverlay) helpOverlay.style.display="none";
    });

    // Ø¯Ø±Ø¨Ø§Ø±Ù‡ Ù…Ø§
    aboutBtn.onclick = ()=>{ aboutOverlay.style.display="flex"; };
    closeAboutBtn.onclick = ()=>{ aboutOverlay.style.display="none"; };
    aboutOverlay.addEventListener("click",e=>{
      if(e.target===aboutOverlay) aboutOverlay.style.display="none";
    });

    // Ù…ØªÙ†â€ŒÙ‡Ø§
    const badWords = [
      "ØªÙ†Ø¨Ù„ÛŒ","Ø¯Ø±ÙˆØº","Ø­Ø³Ø§Ø¯Øª","ØºÛŒØ¨Øª","Ù†Ø§Ø§Ù…ÛŒØ¯ÛŒ",
      "ØªØ±Ø³","Ø®Ø´Ù…","Ø¨Ø¯Ù‚ÙˆÙ„ÛŒ","Ø®ÙˆØ¯Ú©Ù…\u200cØ¨ÛŒÙ†ÛŒ","Ø¨ÛŒ\u200cØ§Ø­ØªØ±Ø§Ù…ÛŒ"
    ];
    const positiveByLabel = {
      "ØªÙ†Ø¨Ù„ÛŒ":"Ø¢ÙØ±ÛŒÙ†! Ù‡Ù…ÛŒÙ† Ú©Ù‡ Ø´Ø±ÙˆØ¹ Ú©Ø±Ø¯ÛŒ ÛŒØ¹Ù†ÛŒ Ø§Ø² ØªÙ†Ø¨Ù„ÛŒ Ø¬Ù„Ùˆ Ø²Ø¯ÛŒ ğŸ’ª",
      "Ø¯Ø±ÙˆØº":"Ø±Ø§Ø³ØªÚ¯ÙˆÛŒÛŒ Ù‡Ù…ÛŒØ´Ù‡ Ø³Ø¨Ú©â€ŒØªØ±Ù‡Ø› ÛŒÚ©ÛŒ Ø§Ø² Ø¯Ø±ÙˆØºâ€ŒÙ‡Ø§ Ø±Ùˆ ØªØ±Ú©ÙˆÙ†Ø¯ÛŒ âœ¨",
      "Ø­Ø³Ø§Ø¯Øª":"ØªÙ…Ø±Ú©Ø² Ø±ÙˆÛŒ Ø±Ø´Ø¯ Ø®ÙˆØ¯ØªØŒ Ø­Ø³Ø§Ø¯Øª Ø±Ùˆ Ú©Ù… Ù…ÛŒâ€ŒÚ©Ù†Ù‡ ğŸŒ±",
      "ØºÛŒØ¨Øª":"Ú©Ù…ØªØ± ØºÛŒØ¨ØªØŒ ÛŒØ¹Ù†ÛŒ Ø¢Ø±Ø§Ù…Ø´ Ø¨ÛŒØ´ØªØ± Ø¨Ø±Ø§ÛŒ Ø¯Ù„ Ø®ÙˆØ¯Øª ğŸ’œ",
      "Ù†Ø§Ø§Ù…ÛŒØ¯ÛŒ":"Ù‡Ù…ÛŒÙ† Ø­Ø§Ù„Ø§ ÛŒÚ© Ù‚Ø¯Ù… Ø¨Ø±Ø¯Ø§Ø´ØªÛŒØ› Ù†Ø§Ø§Ù…ÛŒØ¯ÛŒ Ú©ÙˆÚ†ÛŒÚ©â€ŒØªØ± Ø´Ø¯ âœ¨",
      "ØªØ±Ø³":"Ø´Ø¬Ø§Ø¹Øª ÛŒØ¹Ù†ÛŒ Ø¨Ø§ ÙˆØ¬ÙˆØ¯ ØªØ±Ø³ Ø­Ø±Ú©Øª Ú©Ù†ÛŒØ› ØªÙˆ Ù‡Ù…ÛŒÙ† Ú©Ø§Ø±Ùˆ Ú©Ø±Ø¯ÛŒ ğŸ’›",
      "Ø®Ø´Ù…":"Ù†ÙØ³ Ø¹Ù…ÛŒÙ‚â€¦ ØªÙˆ Ø§Ø² Ø®Ø´Ù…Øª Ù‚ÙˆÛŒâ€ŒØªØ±ÛŒ ğŸŒ¿",
      "Ø¨Ø¯Ù‚ÙˆÙ„ÛŒ":"Ù‡Ù…ÛŒÙ† Ú©Ù‡ Ø­ÙˆØ§Ø³Øª Ø¨Ù‡ Ù‚ÙˆÙ„â€ŒÙ‡Ø§Øª Ù‡Ø³ØªØŒ ÛŒØ¹Ù†ÛŒ Ø¯Ø§Ø±ÛŒ Ø±Ø´Ø¯ Ù…ÛŒâ€ŒÚ©Ù†ÛŒ ğŸ¤",
      "Ø®ÙˆØ¯Ú©Ù…\u200cØ¨ÛŒÙ†ÛŒ":"ØªÙˆ Ø®ÛŒÙ„ÛŒ Ø¨ÛŒØ´ØªØ± Ø§Ø² Ú†ÛŒØ²ÛŒ Ú©Ù‡ ÙÚ©Ø± Ù…ÛŒâ€ŒÚ©Ù†ÛŒ ØªÙˆØ§Ù†Ø§ÛŒÛŒ Ø¯Ø§Ø±ÛŒ ğŸŒŸ",
      "Ø¨ÛŒ\u200cØ§Ø­ØªØ±Ø§Ù…ÛŒ":"Ø§Ù†ØªØ®Ø§Ø¨ Ø§Ø­ØªØ±Ø§Ù…ØŒ ÛŒØ¹Ù†ÛŒ Ø§Ø­ØªØ±Ø§Ù… Ø¨Ù‡ Ø®ÙˆØ¯Øª Ùˆ Ø¯ÛŒÚ¯Ø±Ø§Ù† ğŸ’š"
    };
    const goodMessages = [
      "ØªÙˆ Ù…Ù‡Ø±Ø¨ÙˆÙ†ÛŒ Ø±Ùˆ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ø±Ø¯ÛŒ â¤ï¸",
      "ØªÙˆ Ø¯Ø± Ø­Ø§Ù„ Ø±Ø´Ø¯ Ùˆ Ù¾ÛŒØ´Ø±ÙØªÛŒ ğŸ’ª",
      "ØªÙˆ ØµØ¨ÙˆØ± Ùˆ Ù‚ÙˆÛŒ Ù‡Ø³ØªÛŒ ğŸ’™",
      "ØªÙˆ Ø±Ø§Ø³ØªÚ¯Ùˆ Ùˆ Ø´Ø¬Ø§Ø¹ÛŒ ğŸ’›",
      "ØªÙˆ Ø§Ù†Ø³Ø§Ù† Ù…Ø«Ø¨ØªÛŒ Ù‡Ø³ØªÛŒ âœ¨",
      "ØªÙˆ Ø§Ø² Ø¹Ø§Ø¯Øªâ€ŒÙ‡Ø§ÛŒ Ø¨Ø¯Øª Ù‚ÙˆÛŒâ€ŒØªØ±ÛŒ ğŸ˜",
      "ØªÙˆ Ø§Ù„Ù‡Ø§Ù…â€ŒØ¨Ø®Ø´ Ø§Ø·Ø±Ø§ÙÛŒØ§Ù†ÛŒ ğŸ’œ"
    ];
    function randomItem(arr){return arr[Math.floor(Math.random()*arr.length)];}

    // ÙˆØ¶Ø¹ÛŒØª Ø¨Ø§Ø²ÛŒ
    let paddle,ball,bricks,powerUps,score,level,lives,
        running,paused,strongBallTicks=0,
        slowBallTicks=0,burstTicks=0,totalBricksLevel=0;

    function updateHUD(){
      scoreEl.textContent=score;
      levelEl.textContent=level;
      livesEl.textContent=lives;
    }
    function flashHint(text,ms=2600){
      hintEl.textContent=text;
      if(flashHint._t) clearTimeout(flashHint._t);
      flashHint._t = setTimeout(()=>{
        hintEl.textContent="Ø¨Ø§ Ø§Ù†Ú¯Ø´Øª Ù¾ÙØ¯ Ø±Ø§ Ø­Ø±Ú©Øª Ø¨Ø¯Ù‡ Ùˆ Ø¹Ø§Ø¯Øªâ€ŒÙ‡Ø§ÛŒ Ø¨Ø¯ Ø±Ø§ Ø¨Ø´Ú©Ù† ğŸ’«";
      },ms);
    }
    function updateProgressBar(ratio){
      if(!progressInner) return;
      const v = Math.max(0,Math.min(1,ratio||0));
      progressInner.style.width = (v*100).toFixed(1)+"%";
    }

    function patternForLevel(lvl){
      if(lvl<=10) return "SQUARE";
      if(lvl<=20) return "CIRCLE";
      if(lvl<=30) return "HEART";
      return "SQUARE";
    }

    function brickSizeByLevel(lvl){
      let size;
      if(lvl<=10){
        size = 3 - (2/9)*(lvl-1);
      }else if(lvl<=20){
        size = 2 - (1/9)*(lvl-11);
      }else if(lvl<=30){
        size = 1.5 - (0.5/9)*(lvl-21);
      }else{
        size = 1;
      }
      return size;
    }

    function buildPatternBricks(name,lvl){
      let grid=[];
      const scale = brickSizeByLevel(lvl);
      if(name==="SQUARE"){
        grid=[
          "11111111",
          "11111111",
          "11111111",
          "11111111"
        ];
      }else if(name==="CIRCLE"){
        grid=[
          "000111000",
          "001111100",
          "011111110",
          "011111110",
          "001111100",
          "000111000"
        ];
      }else if(name==="HEART"){
        grid=[
          "00111100111100",
          "01111111111110",
          "11111111111111",
          "11111111111111",
          "01111111111110",
          "00111111111100",
          "00011111111000",
          "00001111110000",
          "00000111100000",
          "00000011000000"
        ];
      }
      const rows=grid.length;
      const cols=grid[0].length;
      const padding=4;
      const brickW=(w-(cols+1)*padding)/cols;
      const baseH=14;
      const brickH=baseH*scale;
      const marginTop=40;
      const out=[];
      for(let r=0;r<rows;r++){
        for(let c=0;c<cols;c++){
          if(grid[r][c]==="1"){
            const x=padding+c*(brickW+padding);
            const y=marginTop+r*(brickH+padding);
            const hits=1+Math.floor(level/2);
            const label=randomItem(badWords);
            const typeRand=Math.random();
            let type="normal";
            if(typeRand<0.1) type="ice";
            else if(typeRand<0.18) type="strong";
            else if(typeRand<0.24) type="bomb";
            else if(typeRand<0.28) type="golden";
            out.push({x,y,w:brickW,h:brickH,hits,label,type});
          }
        }
      }
      return out;
    }

    function buildLevel(){
      const name=patternForLevel(level);
      if(name){
        bricks=buildPatternBricks(name,level);
        flashHint("Ù…Ø±Ø­Ù„Ù‡ "+level+" - Ø§Ù„Ú¯ÙˆÛŒ "+name+" âœ¨");
      }else{
        bricks=[];
      }
      totalBricksLevel=bricks.length;
      updateProgressBar(0);
    }

    function resetGame(){
      const minPadW=40,maxPadW=100;
      const padW=minPadW,padH=12;
      paddle={
        x:(w-padW)/2,
        y:h-40,
        w:padW,
        h:padH,
        minW:minPadW,
        maxW:maxPadW,
        speed:9
      };
      ball={
        x:w/2,
        y:h-60,
        r:6,
        vx:3.5,
        vy:-4.5,
        stuckToPaddle:true
      };
      powerUps=[];
      score=0;
      level=1;
      lives=3;
      running=true;
      paused=false;
      strongBallTicks=0;
      slowBallTicks=0;
      burstTicks=0;
      buildLevel();
      updateHUD();
      updateProgressBar(0);
      flashHint("Ø¨Ø§ Ù¾ÙØ¯ ØªÙˆÙ¾ Ø±Ùˆ Ø¨Ù‡ Ø³Ù…Øª Ø¹Ø§Ø¯Øªâ€ŒÙ‡Ø§ÛŒ Ø¨Ø¯ Ø¨ÙØ±Ø³Øª Ùˆ Ø¨Ø´Ú©Ù†Ø´ÙˆÙ† ğŸ’¥",3000);
    }
    resetGame();

    function movePaddleTo(clientX){
      const rect=canvas.getBoundingClientRect();
      const x=(clientX-rect.left)*(w/rect.width);
      paddle.x=x-paddle.w/2;
      if(paddle.x<0) paddle.x=0;
      if(paddle.x+paddle.w>w) paddle.x=w-paddle.w;
      if(ball.stuckToPaddle){
        ball.x=paddle.x+paddle.w/2;
        ball.y=paddle.y-ball.r-1;
      }
    }
    canvas.addEventListener("mousemove",e=>{
      if(!running||paused) return;
      movePaddleTo(e.clientX);
    });
    canvas.addEventListener("mousedown",e=>{
      if(!running||paused) return;
      if(ball.stuckToPaddle){
        ball.stuckToPaddle=false;
        beep(700);
      }
    });
    canvas.addEventListener("touchstart",e=>{
      if(!running||paused) return;
      const t=e.touches[0];
      movePaddleTo(t.clientX);
      if(ball.stuckToPaddle){
        ball.stuckToPaddle=false;
        beep(700);
      }
      e.preventDefault();
    },{passive:false});
    canvas.addEventListener("touchmove",e=>{
      if(!running||paused) return;
      const t=e.touches[0];
      movePaddleTo(t.clientX);
      e.preventDefault();
    },{passive:false});

    pauseBtn.onclick=()=>{
      if(!running) return;
      paused=!paused;
      pauseBtn.textContent=paused?"â–¶ï¸":"â¸";
      flashHint(paused?"Ø¨Ø§Ø²ÛŒ Ù…ØªÙˆÙ‚Ù Ø´Ø¯ â¸":"Ø§Ø¯Ø§Ù…Ù‡ Ø¨Ø§Ø²ÛŒ â–¶ï¸",1500);
    };

    function showShopMsg(text){
      shopMessage.textContent=text;
      shopMessage.classList.remove("shopMessageVisible");
      void shopMessage.offsetWidth;
      shopMessage.classList.add("shopMessageVisible");
    }
    shopBtn.onclick=()=>{
      if(!running) return;
      shopOverlay.style.display="flex";
    };
    closeShopBtn.onclick=()=>{shopOverlay.style.display="none";};
    shopOverlay.addEventListener("click",e=>{
      if(e.target===shopOverlay) shopOverlay.style.display="none";
    });
    document.querySelectorAll(".shopItem button").forEach(btn=>{
      btn.addEventListener("click",()=>{
        const item=btn.getAttribute("data-item");
        let cost=0;
        if(item==="pad") cost=150;
        else if(item==="strength") cost=220;
        else if(item==="slow") cost=180;
        if(score<cost){
          showShopMsg("Ø§Ù…ØªÛŒØ§Ø² Ú©Ø§ÙÛŒ Ù†Ø¯Ø§Ø±ÛŒ ğŸ˜…");
          beep(200,0.1);
          return;
        }
        score-=cost;
        if(item==="pad"){
          paddle.w=Math.min(paddle.w+12,paddle.maxW);
          flashHint("Ù¾Ø¯Øª Ø¢Ú¯Ø§Ù‡â€ŒØªØ± Ùˆ Ø¨Ø²Ø±Ú¯â€ŒØªØ± Ø´Ø¯ ğŸŒ±");
        }else if(item==="strength"){
          strongBallTicks+=1000;
          flashHint("ØªÙˆÙ¾ Ù‚ÙˆÛŒâ€ŒØªØ± Ø´Ø¯Ø› Ø±Ø§Ø­Øªâ€ŒØªØ± Ù…ÛŒâ€ŒØ´Ú©Ù†ÛŒ ğŸ’ª");
        }else if(item==="slow"){
          slowBallTicks+=900;
          flashHint("Ø¢Ø±Ø§Ù…Ø´Ø› ØªÙˆÙ¾ Ú©Ù…ÛŒ Ú©Ù†Ø¯ØªØ± Ø´Ø¯ ğŸ’™");
        }
        const row=document.querySelector(`.shopItem[data-item-row="${item}"]`);
        if(row){
          row.classList.add("bought");
          setTimeout(()=>row.classList.remove("bought"),260);
        }
        showShopMsg("Ø±ÙØªØ§Ø± Ø®ÙˆØ¨ Ø®Ø±ÛŒØ¯ÛŒØ› Ø¢ÙØ±ÛŒÙ† Ø¨Ù‡ ØªÙˆ â¤ï¸");
        updateHUD();
      });
    });

    function spawnPowerUp(x,y){
      const types=["pad","strength","slow","burst"];
      const type=types[Math.floor(Math.random()*types.length)];
      const labelGood=randomItem(goodMessages);
      powerUps.push({x,y,r:9,vy:1.3,type,labelGood});
    }
    function applyPowerUp(pu){
      if(pu.type==="pad"){
        paddle.w=Math.min(paddle.w+10,paddle.maxW);
        flashHint("Ù…Ù‡Ø±Ø¨Ø§Ù†ÛŒ Ù¾Ø¯Øª Ø±Ùˆ Ø¨Ø²Ø±Ú¯â€ŒØªØ± Ú©Ø±Ø¯ â¤ï¸");
      }else if(pu.type==="strength"){
        strongBallTicks+=900;
        flashHint("ØªÙ„Ø§Ø´ Ø¨ÛŒØ´ØªØ±Ø› ØªÙˆÙ¾ Ù‚ÙˆÛŒâ€ŒØªØ± Ø´Ø¯ ğŸ’ª");
      }else if(pu.type==="slow"){
        slowBallTicks+=800;
        flashHint("Ø¢Ø±Ø§Ù…Ø´Ø› ØªÙˆÙ¾ Ú©Ù…ÛŒ Ú©Ù†Ø¯ØªØ± Ø´Ø¯ ğŸ’™");
      }else if(pu.type==="burst"){
        burstTicks+=260;
        flashHint("Ø­Ø§Ù„Øª Ú†Ù†Ø¯ØªÙˆÙ¾ÛŒ ÙØ¹Ø§Ù„ Ø´Ø¯! ğŸ˜ğŸ”¥",3000);
      }
      flashHint(pu.labelGood,2800);
      beep(900,0.1);
    }

    function showLifeGainEffect(text){
      const el=document.createElement("div");
      el.className="lifeGain";
      el.textContent=text;
      document.body.appendChild(el);
      setTimeout(()=>el.remove(),1000);
    }

    function showGameOver(){
      running=false;
      gameOverOverlay.style.display="flex";
      goScore.textContent="Ø§Ù…ØªÛŒØ§Ø² Ø´Ù…Ø§: "+score;
      goLevel.textContent="Ù…Ø±Ø­Ù„Ù‡â€ŒØ§ÛŒ Ú©Ù‡ Ø±Ø³ÛŒØ¯ÛŒ: "+level;
    }
    retryBtn.onclick=()=>{
      gameOverOverlay.style.display="none";
      resetGame();
      running=true;
    };
    gameOverOverlay.addEventListener("click",e=>{
      if(e.target===gameOverOverlay){
        gameOverOverlay.style.display="none";
        resetGame();
        running=true;
      }
    });

    function update(){
      if(!running||paused) return;
      if(strongBallTicks>0) strongBallTicks--;
      if(slowBallTicks>0) slowBallTicks--;
      if(burstTicks>0) burstTicks--;
      if(ball.stuckToPaddle){
        ball.x=paddle.x+paddle.w/2;
        ball.y=paddle.y-ball.r-1;
        return;
      }
      let speedFactor=1;
      if(slowBallTicks>0) speedFactor*=0.7;
      ball.x+=ball.vx*speedFactor;
      ball.y+=ball.vy*speedFactor;

      if(ball.x-ball.r<0){
        ball.x=ball.r;
        ball.vx*=-1;
      }
      if(ball.x+ball.r>w){
        ball.x=w-ball.r;
        ball.vx*=-1;
      }
      if(ball.y-ball.r<0){
        ball.y=ball.r;
        ball.vy*=-1;
      }

      if(
        ball.y+ball.r>=paddle.y &&
        ball.y+ball.r<=paddle.y+paddle.h &&
        ball.x>=paddle.x && ball.x<=paddle.x+paddle.w &&
        ball.vy>0
      ){
        const hitPos=(ball.x-(paddle.x+paddle.w/2))/(paddle.w/2);
        ball.vx=hitPos*5;
        ball.vy=-Math.abs(ball.vy);
        beep(600);
      }

      if(ball.y-ball.r>h){
        lives--;
        updateHUD();
        if(lives<=0){
          beep(200,0.2);
          showGameOver();
          return;
        }else{
          beep(250,0.16);
          ball.x=paddle.x+paddle.w/2;
          ball.y=paddle.y-ball.r-1;
          ball.vx=3.5*(Math.random()<0.5?-1:1);
          ball.vy=-4.5;
          ball.stuckToPaddle=true;
          burstTicks=0;
        }
      }

      for(const pu of powerUps){
        pu.y+=pu.vy;
      }
      for(let i=powerUps.length-1;i>=0;i--){
        const pu=powerUps[i];
        if(
          pu.y+pu.r>=paddle.y &&
          pu.y-pu.r<=paddle.y+paddle.h &&
          pu.x>=paddle.x && pu.x<=paddle.x+paddle.w
        ){
          applyPowerUp(pu);
          powerUps.splice(i,1);
        }else if(pu.y-pu.r>h){
          powerUps.splice(i,1);
        }
      }

      for(let i=bricks.length-1;i>=0;i--){
        const b=bricks[i];
        if(
          ball.x+ball.r>b.x &&
          ball.x-ball.r<b.x+b.w &&
          ball.y+ball.r>b.y &&
          ball.y-ball.r<b.y+b.h
        ){
          const overlapL=ball.x+ball.r-b.x;
          const overlapR=b.x+b.w-(ball.x-ball.r);
          const overlapT=ball.y+ball.r-b.y;
          const overlapB=b.y+b.h-(ball.y-ball.r);
          const minO=Math.min(overlapL,overlapR,overlapT,overlapB);
          if(minO===overlapL||minO===overlapR) ball.vx*=-1;
          else ball.vy*=-1;

          let damage=1;
          if(strongBallTicks>0) damage=2;
          if(b.type==="ice"){
            if(!b._iceHit){ b._iceHit=true; }
            else b.hits-=damage;
          }else if(b.type==="strong"){
            b.hits-=damage*0.8;
          }else if(b.type==="golden"){
            b.hits-=damage;
          }else{
            b.hits-=damage;
          }

          if(b.hits<=0){
            let baseScore=10;
            if(b.type==="strong") baseScore=14;
            if(b.type==="golden") baseScore=20;
            score+=baseScore;
            if(Math.random()<0.25) spawnPowerUp(b.x+b.w/2,b.y+b.h/2);
            if(b.type==="bomb"){
              for(const nb of bricks){
                if(nb===b) continue;
                const dx=(nb.x+nb.w/2)-(b.x+b.w/2);
                const dy=(nb.y+nb.h/2)-(b.y+b.h/2);
                const dist=Math.sqrt(dx*dx+dy*dy);
                if(dist<60) nb.hits-=damage;
              }
            }
            const posMsg=positiveByLabel[b.label]||`ÛŒÚ©ÛŒ Ø§Ø² "${b.label}"â€ŒÙ‡Ø§ Ø±Ùˆ Ø´Ú©Ø³ØªÛŒØ› Ø¢ÙØ±ÛŒÙ† ğŸ’š`;
            flashHint(posMsg,2600);
            bricks.splice(i,1);
            if(totalBricksLevel>0){
              const cleared=totalBricksLevel-bricks.length;
              updateProgressBar(cleared/totalBricksLevel);
            }
          }else{
            score+=3;
          }
          beep(800,0.05);
          updateHUD();
          break;
        }
      }

      if(bricks.length===0){
        level++;
        lives+=2;          // â¤ï¸ Ø¯Ùˆ Ø¬ÙˆÙ† Ø¬Ø¯ÛŒØ¯
        updateHUD();
        showLifeGainEffect("+2 â¤ï¸");

        ball.stuckToPaddle=true;
        ball.x=paddle.x+paddle.w/2;
        ball.y=paddle.y-ball.r-1;
        ball.vx*=1.08;
        ball.vy*=1.08;

        buildLevel();
        updateHUD();
        updateProgressBar(0);
        flashHint("Ù…Ø±Ø­Ù„Ù‡ "+level+" Ø´Ø±ÙˆØ¹ Ø´Ø¯Ø› Û² ØªØ§ Ø¬ÙˆÙ† ØªØ§Ø²Ù‡ Ú¯Ø±ÙØªÛŒ â¤ï¸",2500);
        beep(1000,0.15);
      }
    }

    function draw(){
      ctx.clearRect(0,0,w,h);
      const g=ctx.createLinearGradient(0,0,0,h);
      g.addColorStop(0,"#151b5c");
      g.addColorStop(1,"#09071e");
      ctx.fillStyle=g;
      ctx.fillRect(0,0,w,h);

      for(const b of bricks){
        let color="#ffb347";
        if(b.type==="ice") color="#66d9ff";
        else if(b.type==="strong") color="#ff6f91";
        else if(b.type==="bomb") color="#c084ff";
        else if(b.type==="golden") color="#ffd700";
        ctx.fillStyle=color;
        ctx.fillRect(b.x,b.y,b.w,b.h);
        ctx.fillStyle="#00000040";
        ctx.fillRect(b.x,b.y+b.h-3,b.w,3);
        ctx.save();
        ctx.fillStyle="#111";
        ctx.font="9px Vazirmatn";
        ctx.textAlign="center";
        ctx.textBaseline="middle";
        ctx.direction="rtl";
        ctx.fillText(b.label,b.x+b.w/2,b.y+b.h/2);
        ctx.restore();
      }

      for(const pu of powerUps){
        let c="#1abc9c";
        if(pu.type==="strength") c="#ff9f43";
        else if(pu.type==="slow") c="#9b59b6";
        else if(pu.type==="burst") c="#e91e63";
        ctx.beginPath();
        ctx.arc(pu.x,pu.y,pu.r,0,Math.PI*2);
        const g2=ctx.createRadialGradient(pu.x,pu.y,2,pu.x,pu.y,pu.r+3);
        g2.addColorStop(0,"#ffffff");
        g2.addColorStop(1,c);
        ctx.fillStyle=g2;
        ctx.fill();
        ctx.strokeStyle="#ffffffaa";
        ctx.lineWidth=1;
        ctx.stroke();
      }

      ctx.fillStyle="#3ac7ff";
      ctx.fillRect(paddle.x,paddle.y,paddle.w,paddle.h);
      ctx.fillStyle="#ffffff55";
      ctx.fillRect(paddle.x,paddle.y,paddle.w,3);

      if(burstTicks>0){
        const t=Date.now()/300;
        const count=4,offset=8;
        for(let i=0;i<count;i++){
          const ang=(Math.PI*2/count)*i+t;
          const bx=ball.x+Math.cos(ang)*offset;
          const by=ball.y+Math.sin(ang)*offset;
          ctx.beginPath();
          ctx.arc(bx,by,ball.r-2,0,Math.PI*2);
          ctx.fillStyle="rgba(255,255,255,0.35)";
          ctx.fill();
        }
      }

      ctx.beginPath();
      ctx.arc(ball.x,ball.y,ball.r,0,Math.PI*2);
      ctx.fillStyle=strongBallTicks>0?"#fffb8a":"#ffffff";
      ctx.fill();
      ctx.strokeStyle="#ffffff55";
      ctx.lineWidth=1;
      ctx.stroke();
    }

    function loop(){
      update();
      draw();
      requestAnimationFrame(loop);
    }
    loop();
  </script>
</body>
</html>
